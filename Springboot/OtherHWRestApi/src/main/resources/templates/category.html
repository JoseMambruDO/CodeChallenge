<!doctype html>
<html lang="en">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
	integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
	crossorigin="anonymous">
<!-- Font Awesome -->
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
	integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
	crossorigin="anonymous">

<title>OtherHWRestApi</title>
</head>
<body>

	<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
		<ul class="navbar-nav">
			<li class="nav-item active"><a class="nav-link" href="#">OtherHWRestApi</a>
			</li>
			<li class="nav-item"><a class="nav-link" href="/product">Product</a></li>
			<li class="nav-item"><a class="nav-link" href="/category">Category</a></li>

		</ul>
	</nav>

	<div class="container-fluid">
		<h3>Categories</h3>



		<input id="inputCategories" type="text" placeholder="Looking category"
			onkeyup="app.findCategories()">

		<button type="button" class="btn btn-primary" data-toggle="modal"
			data-target="#detailCategory" onclick="app.clearForAdding();">Create
			new category</button>

		<table id="table" class="table" width="border:1px;">
			<thead>
				<tr>
					<th>ID</th>
					<th>Name</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody id='tb_categories'>

			</tbody>
		</table>


		<!-- Category Detail -->



		<!-- Modal Detail-->
		<div class="modal fade" id="detailCategory" tabindex="-1"
			role="dialog" aria-labelledby="detailCategoryLabel"
			aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="detailCategoryLabel">Category</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<input id="fc_id" name="fc_id" placeholder="id"
							readonly="readonly" type="text"> <br> <input
							id="fc_name" name="fc_name" required="required"
							placeholder="name" type="text"> <br>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" onclick="app.save()">Save</button>
					</div>
				</div>
			</div>
		</div>


	</div>

	<script>
		var srcCategories = '/api/v1/categories';
		var currRow = {};

		var app = new function() {

			this.save = function() {
				var categorName = document.getElementById("fc_name").value;

				if (!validatField()) {
					alert("Category entity is not valid");

				} else {

					switch (state) {
					case "ADDING":
						this.addCategory();
						break;
					case "EDITING":
						this.editCategory();
						break;
					case "DELETING":
						this.deleteCategory();
						break;

					}

					$("#detailCategory").modal('hide');
				}
			}

			function validatField() {
				categorName = document.getElementById("fc_name").value;
				return (categorName !== "");

			}
			this.clearDetail = function() {

				document.getElementById("fc_id").value = "";
				document.getElementById("fc_name").value = "";
			}

			this.clearForAdding = function() {
				state = "ADDING";
				this.clearDetail();
			}

			function renderHTML() {
				if (currRow !== {}) {
					document.getElementById("fc_id").value = currRow['id'];
					document.getElementById("fc_name").value = currRow['name'];
					$("#detailCategory").modal('show');
				}
			}

			this.preEditing = function(id) {
				state = "EDITING";
				this.getCategory(id, cbf, renderHTML);

			}

			function cbf(dataCR, act) {
				currRow = dataCR;
				act();
			}

			this.preDeleting = function(id) {
				state = "DELETING";
				this.getCategory(id, cbf, renderHTML);
			}

			this.getCategory = function(id, cb, act) {

				var url = srcCategories + "/findByID/" + id;
				curRow = {};
				var xhr = new XMLHttpRequest();
				xhr.onload = function() {
					if (xhr.status >= 200 && xhr.status < 300) {

						var data = JSON.parse(this.responseText);

						data = (data.content || data);

						cb(data, act);

					} else {
						result = 'The request failed!';
					}

				};
				xhr.open('GET', url);
				xhr.send();

			}

			this.addCategory = function() {

				dataCategory = {};
				dataCategory.name = document.getElementById('fc_name').value;

				var json = JSON.stringify(dataCategory);
				var xhr = new XMLHttpRequest();
				xhr.open("POST", srcCategories, true);
				xhr.setRequestHeader('Content-type',
						'application/json; charset=utf-8');
				xhr.onload = function() {

					if (xhr.status == "200") {
						app.findCategories();
						console.log("Category was added.");
					} else {
						console.log("Something worng, adding a new category.");
					}
				}
				xhr.send(json);

				this.findCategories();
			}

			this.editCategory = function() {

				dataCategory = {};
				dataCategory.id = document.getElementById('fc_id').value;
				dataCategory.name = document.getElementById('fc_name').value;

				var url = srcCategories + "/" + dataCategory.id
				console.log(url);
				var json = JSON.stringify(dataCategory);
				var xhr = new XMLHttpRequest();
				xhr.open("PUT", url, true);
				xhr.setRequestHeader('Content-type',
						'application/json; charset=utf-8');
				xhr.onload = function() {

					if (xhr.status == "200") {
						app.findCategories();
						console.log("Category was Edited.");

					} else {
						console
								.log("Something worng, editing a new category.");
					}
				}
				xhr.send(json);
			}

			this.deleteCategory = function() {

				dataCategory = {};
				dataCategory.id = document.getElementById('fc_id').value;

				var url = srcCategories + "/" + dataCategory.id
				var xhr = new XMLHttpRequest();
				xhr.open("DELETE", url, true);
				xhr.setRequestHeader('Content-type',
						'text/plain; charset=utf-8');

				xhr.onload = function() {

					if (xhr.status == "200") {
						app.findCategories();
						console.log("Category was Edited.");

					} else {
						console
								.log("Something worng, deleting a new category.");
					}
				}

				xhr.send();

			}

			this.findCategories = function() {

				//getting value for filtering
				var el = document.getElementById('inputCategories');

				var value = (el.innerText || el.textContent || el.value);

				var url = srcCategories;

				if (value !== '') {
					url = srcCategories + '/findByName/' + value;
				}

				var xhr = new XMLHttpRequest();
				xhr.onload = function() {
					if (xhr.status >= 200 && xhr.status < 300) {

						var data = JSON.parse(this.responseText);

						data = (data.content || data);

						var out = '';
						for (i = 0; i < data.length; i++) {
							out += '<tr>';
							out += '<td>' + data[i].id + '</td>';
							out += '<td>' + data[i].name + '</td>';

							out += '<td><a id="rw' + data[i].id + '" href="#" '
									+ data[i].id + '" onclick="app.preEditing('
									+ data[i].id + ')">Edit</a>';
							out += '<a id="rw' + data[i].id + '" href="#" '
									+ data[i].id
									+ '" onclick="app.preDeleting('
									+ data[i].id + ')">Delete</a>';
							out += '</td>';

							out += '<tr>';
						}
						document.getElementById('tb_categories').innerHTML = out;
					} else {
						result = 'The request failed!';
					}

				};
				xhr.open('GET', url);
				xhr.send();

			};

		}

		app.findCategories();
	</script>


	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
		integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
		crossorigin="anonymous"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script
		src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>
</body>
</html>